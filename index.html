<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Ventas</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .ventas { margin-top: 20px; }
        .venta { border-bottom: 1px solid #ddd; padding: 10px 0; }
    </style>
    <script>
        // WebSocket connection
        const socket = new WebSocket('ws://localhost:3000');

        // IndexedDB setup
        const dbRequest = indexedDB.open('ventasDB', 1);
        let db;

        dbRequest.onupgradeneeded = event => {
            db = event.target.result;
            db.createObjectStore('ventas', { keyPath: 'id', autoIncrement: true });
        };

        dbRequest.onsuccess = event => {
            db = event.target.result;
            displayVentas();
        };

        dbRequest.onerror = event => {
            console.error('Error opening IndexedDB:', event);
        };

        // Register a sale
        function registrarVenta(venta) {
            const transaction = db.transaction(['ventas'], 'readwrite');
            const store = transaction.objectStore('ventas');
            store.add(venta);
            
            transaction.oncomplete = () => {
                socket.send(JSON.stringify(venta));
                displayVentas();
            };
        }

        // Display sales
        function displayVentas() {
            const transaction = db.transaction(['ventas'], 'readonly');
            const store = transaction.objectStore('ventas');
            const request = store.getAll();

            request.onsuccess = event => {
                const ventas = event.target.result;
                const ventasDiv = document.getElementById('ventas');
                ventasDiv.innerHTML = '';

                ventas.forEach(venta => {
                    const div = document.createElement('div');
                    div.className = 'venta';
                    div.textContent = `Venta: ${venta.datos}`;
                    ventasDiv.appendChild(div);
                });
            };
        }

        // Handle new sales from WebSocket
        socket.onmessage = event => {
            const venta = JSON.parse(event.data);
            registrarVenta(venta);
        };
    </script>
</head>
<body>
    <h1>Sistema de Ventas</h1>
    <form id="ventaForm">
        <input type="text" id="datosVenta" placeholder="Datos de la venta">
        <button type="button" onclick="registrarVenta({ datos: document.getElementById('datosVenta').value })">Registrar Venta</button>
    </form>
    <div id="ventas" class="ventas"></div>
</body>
</html>
